<!DOCTYPE html>
<html>
<body style="background:black;color:white">

<div id="list">Carregando...</div>
<video id="v" controls></video>
<canvas id="c" width="96" height="96" hidden></canvas>

<script>
const v=document.getElementById("v")
const c=document.getElementById("c")
const x=c.getContext("2d")
const list=document.getElementById("list")

fetch("/videosList").then(r=>r.json()).then(videos=>{
  list.innerHTML=""
  videos.forEach(o=>{
    const b=document.createElement("button")
    b.innerText=o.name
    b.onclick=()=>{
      v.src=o.url
      v.play()
      fetch("/setAudio",{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({audio:o.url.replace(".mp4",".mp3")})
      })
    }
    list.appendChild(b)
  })
})

setInterval(()=>{
  if(v.paused||v.videoWidth===0)return
  x.drawImage(v,0,0,96,96)
  fetch("/camera",{method:"POST",headers:{"Content-Type":"application/json"},
    body:JSON.stringify({image:c.toDataURL("image/jpeg",0.5).split(",")[1]})
  })
},50)
</script>
</body>
</html>
