<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Video</title>
<style>
body {
  background:black;
  color:white;
  font-family:sans-serif;
  display:flex;
  flex-direction:column;
  align-items:center;
}
/* Estilo para os bot√µes */
button {
  margin:4px;
  padding:6px 12px;
  cursor: pointer;
}
video {
  width:320px;
  margin-top:10px;
  border:2px solid white;
}
/* Container para os controles ficarem lado a lado */
.controls {
  display: flex;
  flex-direction: row;
  margin-top: 10px;
}
</style>
</head>
<body>

<h3>V√≠deos</h3>
<div id="list"></div>

<video id="vid" crossorigin="anonymous"></video>

<div class="controls">
  <button onclick="vid.pause()">‚è∏ Pause</button>
  <button onclick="vid.play()">‚ñ∂ Play</button>
  <button id="loopBtn" onclick="toggleLoop()">üîÅ Loop: Off</button>
</div>

<canvas id="c" width="64" height="64" hidden></canvas>

<script>
const list = document.getElementById("list")
const vid = document.getElementById("vid")
const canvas = document.getElementById("c")
const ctx = canvas.getContext("2d")
const loopBtn = document.getElementById("loopBtn")

// Fun√ß√£o para ativar/desativar o Loop
function toggleLoop() {
  // Inverte o estado do loop (se true vira false, se false vira true)
  vid.loop = !vid.loop;
  
  // Atualiza o texto do bot√£o
  if (vid.loop) {
    loopBtn.innerText = "üîÅ Loop: On";
    loopBtn.style.backgroundColor = "#4CAF50"; // (Opcional) Fica verde quando ligado
    loopBtn.style.color = "white";
  } else {
    loopBtn.innerText = "üîÅ Loop: Off";
    loopBtn.style.backgroundColor = ""; // Volta a cor original
    loopBtn.style.color = "";
  }
}

fetch("/videosList")
.then(r=>r.json())
.then(videos=>{
  videos.forEach(v=>{
    const b = document.createElement("button")
    b.innerText = v.name
    b.onclick = ()=>{
      vid.src = v.url
      vid.play()

      // Opcional: Se quiser garantir que o loop se mantenha desligado ao trocar de v√≠deo, descomente a linha abaixo:
      // vid.loop = false; updateLoopButtonUI();

      fetch("/setAudio",{
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body: JSON.stringify({
          audio: v.url.replace(".mp4",".mp3")
        })
      })
    }
    list.appendChild(b)
  })
})

setInterval(()=>{
  if (vid.paused || vid.ended) return
  ctx.drawImage(vid,0,0,64,64)
  fetch("/camera",{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify({
      image: canvas.toDataURL("image/jpeg",0.5).split(",")[1]
    })
  })
},50)
</script>

</body>
</html>
